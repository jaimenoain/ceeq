# AI Project Status
**Current Phase:** Phase 3 - Core Workflows & UI Orchestration
**Last Completed Task:** Task 3.1.6: Server Actions for Sourcing Universe - COMPLETE
**Next Task:** Task 3.2: Searcher Dashboard UI & Data Integration
**Active Blockers:** None

**Notes:**
- **Tech Debt & Deprecation Plan:**
    - `DummyAuthProvider` has been removed.
    - Layout architecture verified: Searcher uses `bg-white`, Investor uses `bg-slate-900`. Consistent with design specs.
    - No outstanding `TODO` comments found in core auth/api files.
    - **Environment Variables:** `DOMAIN_HASH_SECRET` is now required for the cryptographic domain hashing utility.

**Current File Structure:**
- `supabase/migrations`:
    - `00001_core_schema.sql`: Core schema implementation with strict Tenant Isolation via RLS.
    - `00004_sourcing_targets.sql`: SourcingTarget schema with RLS policies.
    - `00005_add_created_at_to_sourcing_target.sql`: Added createdAt timestamp to SourcingTarget.
- `src/shared/types`:
    - `supabase.ts`: Manually generated Supabase Database types matching PostgreSQL schema.
- `src/shared/lib`:
    - `crypto-domain.ts`: SHA-256 domain hashing and normalization utility (Server-side only).
- `src/app/(auth)`:
    - `layout.tsx`: Auth layout shell.
    - `/login`: Real Supabase Authentication entry point.
    - `/onboarding`: User onboarding flow.
- `src/app/(searcher)`:
    - `layout.tsx`: Searcher layout with sidebar.
    - `/searcher/dashboard`: Searcher main dashboard.
    - `/searcher/pipeline`: Deal pipeline view.
    - `/searcher/universe`: Target universe exploration.
- `src/app/(investor)`:
    - `layout.tsx`: Investor layout with distinct sidebar.
    - `/investor/dashboard`: Investor overview.
    - `/investor/deals`: Investment opportunities.

**Technical Decisions:**
- Implemented base routing skeleton using Next.js Route Groups and strict React Server Components. Root page configured to redirect to /login.
- Implemented @tanstack/react-query for server state, next-themes for appearance, and @supabase/ssr for authenticated data fetching.
- Added Repomix Context Packer with XML output and strict secret exclusion.
- Removed `DummyAuthProvider` and `NEXT_PUBLIC_USE_MOCKS` check in `auth-utils.ts` to enforce real Supabase Auth.
- Implemented `LoginForm` using `react-hook-form`, `zod`, and `supabase-js` with support for Email/Password and OAuth (Google/Microsoft).
- **Database Schema:** Created `00001_core_schema.sql` defining `Workspace`, `User`, `Company`, `Deal` tables with strict RLS policies for tenant isolation.
- **Type Safety:** Implemented `src/shared/types/supabase.ts` manually to mirror the database schema, ensuring strict typing for Supabase client usage.
- **Middleware & Routing:** Implemented `src/middleware.ts` using `@supabase/ssr` to enforce strict Role-Based Access Control (RBAC). Extracted `getProtectedRedirect` logic to verify routing matrix (Auth, Workspace, Cross-Role).
- **Validation:** Integrated `zod` for server-side validation. Created `src/features/auth/schemas.ts` with `OnboardingSubmitSchema` to enforce irreversible role selection. Verified with `verify_auth_schema.ts`.
- **Onboarding UI:** Implemented split-screen onboarding flow using `src/features/auth/components/onboarding-form.tsx`. Wired to `completeOnboardingAction`. Configured Tailwind to scan `src/features`.
- **Automated QA:** Executed full build pipeline (`tsc`, `lint`, `build`). Verified type safety across Supabase boundaries. Deleted obsolete `verify_auth_bypass.ts`. Build is clean.
- **Security:** Implemented `src/shared/lib/crypto-domain.ts` for secure SHA-256 domain hashing using a server-side pepper (`DOMAIN_HASH_SECRET`). This ensures zero-knowledge overlapping NDA detection.

### KNOWN_ISSUES
- None

### CURRENT_ARCHITECTURE_SNAPSHOT
- **Route Groups & Layouts**:
  - `(auth)`: Login, Onboarding. (Centered Layout)
  - `(searcher)`: Dashboard, Universe, Pipeline. (Sidebar Layout)
  - `(investor)`: Dashboard, Deals. (Sidebar Layout)
- **Providers**:
  - `ThemeProvider` (next-themes)
  - `QueryProvider` (@tanstack/react-query)
- **Global State/Data**:
  - `src/shared/lib/api.ts`: Centralized fetch wrapper with mock interception.
  - `src/shared/lib/auth-utils.ts`: Auth redirection logic.
  - `src/shared/types/supabase.ts`: Supabase Database types.
  - `src/shared/lib/crypto-domain.ts`: Domain hashing utility.

**Feature Status:**
- [x] Task 0.3: Base Routing & Layout Architecture
- [x] Task 0.4: Global Infrastructure
- [x] Task 0.5: Context Optimization
- [x] Task 0.6: Layout Verification
- [x] Task 1.1: The Layout Shell & Navigation UI
- [x] Task 1.2: Global Services & Mocking
- [x] Task 1.97: Automated Build & Integrity Check
- [x] Task 1.99: Phase Review & Architecture Update - COMPLETE
- [x] Phase 1 - COMPLETE
- [x] Task: Renamed SearchFundOS to Ceeq across codebase and documentation.
- [x] Task 2.0: Tech Debt & Stability Check - COMPLETE
- [x] Task 2.1: Database Schema & RLS Setup - COMPLETE
- [x] Task 2.2: Supabase Authentication Integration - COMPLETE
- [x] Task 2.3: User Onboarding Flow (Schema Validation) - COMPLETE
- [x] Task 2.4: The Onboarding UX & Server Actions - COMPLETE
- [x] Task 2.5: User Dashboard & Role-Based Access - COMPLETE
- [x] Task 2.97: Automated QA & Logic Verification - COMPLETE
- [x] Phase 2 - Data Layer & Identity Provisioning - COMPLETE
- [x] Task 3.1: SourcingTarget Schema & RLS - COMPLETE
- [x] Task 3.1.5: Secure Domain Hashing Utility - COMPLETE
- [x] Task 3.1.6: Server Actions for Sourcing Universe - COMPLETE
- [ ] Task 3.2: Searcher Dashboard UI & Data Integration
