# AI Project Status
**Current Phase:** Phase 2 - Data Layer & Identity Provisioning
**Last Completed Task:** Task 2.4: The Onboarding UX & Server Actions - COMPLETE
**Next Task:** Task 2.5: User Dashboard & Role-Based Access
**Active Blockers:** None

**Notes:**
- **Tech Debt & Deprecation Plan:**
    - `DummyAuthProvider` (`src/shared/components/providers/dummy-auth-provider.tsx`) is scheduled for deprecation in favor of real Supabase Auth.
    - `src/shared/lib/api.ts` contains mock interception logic (`NEXT_PUBLIC_USE_MOCKS`) and a hacky `as unknown as Response` implementation that must be removed.
    - Layout architecture verified: Searcher uses `bg-white`, Investor uses `bg-slate-900`. Consistent with design specs.
    - No outstanding `TODO` comments found in core auth/api files.

**Current File Structure:**
- `supabase/migrations`:
    - `00001_core_schema.sql`: Core schema implementation with strict Tenant Isolation via RLS.
- `src/shared/types`:
    - `supabase.ts`: Manually generated Supabase Database types matching PostgreSQL schema.
- `src/shared/components/providers`:
    - `dummy-auth-provider.tsx`: Mock authentication context (To be deprecated).
- `src/app/(auth)`:
    - `layout.tsx`: Auth layout shell.
    - `/login`: Authentication entry point (redirects in mock mode).
    - `/onboarding`: User onboarding flow.
- `src/app/(searcher)`:
    - `layout.tsx`: Searcher layout with sidebar.
    - `/searcher/dashboard`: Searcher main dashboard.
    - `/searcher/pipeline`: Deal pipeline view.
    - `/searcher/universe`: Target universe exploration.
- `src/app/(investor)`:
    - `layout.tsx`: Investor layout with distinct sidebar.
    - `/investor/dashboard`: Investor overview.
    - `/investor/deals`: Investment opportunities.

**Technical Decisions:**
- Implemented base routing skeleton using Next.js Route Groups and strict React Server Components. Root page configured to redirect to /login.
- Implemented @tanstack/react-query for server state, next-themes for appearance, and @supabase/ssr for authenticated data fetching.
- Added Repomix Context Packer with XML output and strict secret exclusion.
- Implemented synchronous state initialization in `DummyAuthProvider` to support SSR and avoid hydration mismatches when `NEXT_PUBLIC_USE_MOCKS=true`.
- Implemented `NEXT_PUBLIC_USE_MOCKS` pattern. Added `api.ts` fetch wrapper with request interception. Created `DummyAuthProvider` to bypass Supabase and auto-route to dashboards during UI dev.
- Refactored `DummyAuthProvider` and `RootPage` logic into pure functions (`getInitialUser`, `getRedirectPath`) to enable standalone verification without full component rendering.
- Moved `getRedirectPath` to `src/shared/lib/auth-utils.ts` to avoid Next.js invalid page export errors.
- Successfully passed initial static analysis, linting, and production build steps.
- **Database Schema:** Created `00001_core_schema.sql` defining `Workspace`, `User`, `Company`, `Deal` tables with strict RLS policies for tenant isolation.
- **Type Safety:** Implemented `src/shared/types/supabase.ts` manually to mirror the database schema, ensuring strict typing for Supabase client usage.
- **Middleware & Routing:** Implemented `src/middleware.ts` using `@supabase/ssr` to enforce strict Role-Based Access Control (RBAC). Extracted `getProtectedRedirect` logic to verify routing matrix (Auth, Workspace, Cross-Role).
- **Validation:** Integrated `zod` for server-side validation. Created `src/features/auth/schemas.ts` with `OnboardingSubmitSchema` to enforce irreversible role selection. Verified with `verify_auth_schema.ts`.
- **Onboarding UI:** Implemented split-screen onboarding flow using `src/features/auth/components/onboarding-form.tsx`. Wired to `completeOnboardingAction`. Configured Tailwind to scan `src/features`.

### CURRENT_ARCHITECTURE_SNAPSHOT
- **Route Groups & Layouts**:
  - `(auth)`: Login, Onboarding. (Centered Layout)
  - `(searcher)`: Dashboard, Universe, Pipeline. (Sidebar Layout)
  - `(investor)`: Dashboard, Deals. (Sidebar Layout)
- **Providers**:
  - `ThemeProvider` (next-themes)
  - `QueryProvider` (@tanstack/react-query)
  - `DummyAuthProvider` (Mock Auth - Deprecated)
- **Global State/Data**:
  - `src/shared/lib/api.ts`: Centralized fetch wrapper with mock interception.
  - `src/shared/lib/auth-utils.ts`: Auth redirection logic.
  - `src/shared/types/supabase.ts`: Supabase Database types.

**Feature Status:**
- [x] Task 0.3: Base Routing & Layout Architecture
- [x] Task 0.4: Global Infrastructure
- [x] Task 0.5: Context Optimization
- [x] Task 0.6: Layout Verification
- [x] Task 1.1: The Layout Shell & Navigation UI
- [x] Task 1.2: Global Services & Mocking
- [x] Task 1.97: Automated Build & Integrity Check
- [x] Task 1.99: Phase Review & Architecture Update - COMPLETE
- [x] PHASE 1 - COMPLETE
- [x] Task: Renamed SearchFundOS to Ceeq across codebase and documentation.
- [x] Task 2.0: Tech Debt & Stability Check - COMPLETE
- [x] Task 2.1: Database Schema & RLS Setup - COMPLETE
- [x] Task 2.2: Supabase Authentication Integration - COMPLETE
- [x] Task 2.3: User Onboarding Flow (Schema Validation) - COMPLETE
- [x] Task 2.4: The Onboarding UX & Server Actions - COMPLETE
